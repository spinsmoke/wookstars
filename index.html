<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>WookStars</title>

  <style>
    :root{
      --bg: #07060a;
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.68);
      --stroke: rgba(255,255,255,.14);
      --glow: 0 0 25px rgba(255, 0, 170, .20), 0 0 45px rgba(0, 255, 255, .12);
      --radius: 18px;
    }
    * { box-sizing: border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:
        radial-gradient(1200px 700px at 10% 10%, rgba(255,0,170,.15), transparent 60%),
        radial-gradient(900px 600px at 90% 20%, rgba(0,255,255,.12), transparent 60%),
        radial-gradient(1000px 700px at 50% 90%, rgba(255,255,0,.06), transparent 60%),
        var(--bg);
      color: var(--text);
      min-height: 100vh;
    }

    /* Trippy border wrap */
    .frame{ position: relative; padding: 16px; min-height: 100vh; }
    .frame::before{
      content:"";
      position:absolute;
      inset: 10px;
      border-radius: 28px;
      padding: 3px;
      background: conic-gradient(
        from 0deg,
        rgba(255,0,170,.95),
        rgba(0,255,255,.95),
        rgba(255,255,0,.75),
        rgba(140,0,255,.90),
        rgba(255,0,170,.95)
      );
      z-index:0;
      animation: spin 10s linear infinite;
      filter: blur(.2px);
    }
    .frame::after{
      content:"";
      position:absolute;
      inset: 14px;
      border-radius: 26px;
      background: rgba(0,0,0,.70);
      z-index:0;
      box-shadow: var(--glow);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    .container{
      position: relative;
      z-index: 1;
      max-width: 1150px;
      margin: 0 auto;
      padding: 22px 18px 34px;
    }

    header{
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 14px;
      padding: 14px 10px 6px;
    }
    .brand{ display:flex; align-items:center; gap: 14px; min-width: 260px; }
    .logo{
      width: 210px;
      max-width: 52vw;
      height: auto;
      display:block;
      filter: drop-shadow(0 0 18px rgba(255,0,170,.20));
    }

    .top-actions{
      display:flex;
      gap: 10px;
      align-items:center;
      flex-wrap: wrap;
      justify-content: flex-end;
    }
    .pill{
      background: rgba(255,255,255,.06);
      border: 1px solid var(--stroke);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 999px;
      display:flex;
      align-items:center;
      gap: 10px;
      box-shadow: 0 8px 28px rgba(0,0,0,.30);
    }
    .pill input{
      background: transparent;
      border: none;
      outline: none;
      color: var(--text);
      min-width: 220px;
    }

    .btn{
      appearance:none;
      border:none;
      cursor:pointer;
      padding: 11px 14px;
      border-radius: 999px;
      background: linear-gradient(90deg, rgba(255,0,170,.85), rgba(0,255,255,.70));
      color: #0b0710;
      font-weight: 800;
      box-shadow: 0 10px 28px rgba(0,0,0,.35);
      transition: transform .08s ease;
      white-space: nowrap;
    }
    .btn:active{ transform: scale(.98); }
    .btn:disabled{ opacity:.65; cursor:not-allowed; }

    /* Tagline under logo */
    .tagline{
      margin: 8px 10px 18px;
      padding: 14px 16px;
      border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.04));
      border: 1px solid var(--stroke);
      box-shadow: 0 12px 34px rgba(0,0,0,.35);
    }
    .tagline h1{ margin: 0 0 6px 0; font-size: 18px; letter-spacing: .2px; }
    .tagline p{ margin: 0; color: var(--muted); line-height: 1.45; font-size: 14px; }

    .cats{ display:flex; gap: 8px; flex-wrap: wrap; margin: 10px 10px 16px; }
    .chip{
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.06);
      color: var(--text);
      padding: 8px 10px;
      border-radius: 999px;
      cursor:pointer;
      user-select: none;
      font-size: 13px;
    }
    .chip.active{
      background: rgba(0,255,255,.12);
      border-color: rgba(0,255,255,.35);
      box-shadow: 0 0 0 3px rgba(0,255,255,.08);
    }

    main{
      display:grid;
      grid-template-columns: 1fr 330px;
      gap: 16px;
      align-items:start;
      padding: 0 10px;
    }
    .feed{
      display:grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 14px;
    }
    @media (max-width: 980px){
      main{ grid-template-columns: 1fr; }
      .feed{ grid-template-columns: repeat(2, minmax(0,1fr)); }
    }
    @media (max-width: 560px){
      .feed{ grid-template-columns: 1fr; }
      .pill input{ min-width: 140px; }
      .logo{ width: 180px; }
    }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.04));
      border: 1px solid var(--stroke);
      border-radius: var(--radius);
      overflow:hidden;
      box-shadow: 0 14px 40px rgba(0,0,0,.35);
      transition: transform .12s ease;
    }
    .card:hover{ transform: translateY(-2px); }

    .thumb{
      position: relative;
      aspect-ratio: 16/9;
      background: rgba(255,255,255,.05);
      overflow:hidden;
    }
    .thumb img{ width: 100%; height: 100%; object-fit: cover; display:block; }
    .badge{
      position:absolute;
      left: 10px;
      top: 10px;
      font-size: 12px;
      padding: 6px 8px;
      border-radius: 999px;
      background: rgba(0,0,0,.55);
      border: 1px solid rgba(255,255,255,.16);
      backdrop-filter: blur(6px);
    }
    .play{
      position:absolute;
      right: 10px;
      bottom: 10px;
      font-size: 12px;
      padding: 6px 9px;
      border-radius: 999px;
      background: rgba(0,0,0,.55);
      border: 1px solid rgba(255,255,255,.16);
      backdrop-filter: blur(6px);
    }
    .meta{ padding: 12px 12px 14px; }
    .title{ margin: 0 0 8px; font-size: 14px; line-height: 1.25; font-weight: 800; letter-spacing: .2px; }
    .sub{ display:flex; justify-content: space-between; gap: 10px; color: var(--muted); font-size: 12px; }
    .link{ color: inherit; text-decoration: none; display:block; }

    aside{ position: sticky; top: 14px; display:flex; flex-direction: column; gap: 14px; height: fit-content; }
    .panel{
      background: linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.04));
      border: 1px solid var(--stroke);
      border-radius: var(--radius);
      padding: 14px;
      box-shadow: 0 14px 40px rgba(0,0,0,.35);
    }
    .panel h2{ margin: 0 0 10px; font-size: 14px; letter-spacing: .3px; }
    .panel p{ margin: 0; color: var(--muted); font-size: 13px; line-height: 1.45; }
    .small{ font-size: 12px; color: var(--muted); }

    footer{ padding: 22px 10px 8px; color: var(--muted); font-size: 12px; text-align:center; }

    /* Modal */
    .modal-backdrop{
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.65);
      display:none;
      align-items:center;
      justify-content:center;
      padding: 18px;
      z-index: 50;
    }
    .modal{
      width: min(650px, 100%);
      background: rgba(18, 14, 24, .95);
      border: 1px solid rgba(255,255,255,.14);
      border-radius: 18px;
      box-shadow: 0 25px 80px rgba(0,0,0,.55);
      overflow:hidden;
    }
    .modal-head{
      display:flex;
      justify-content: space-between;
      align-items:center;
      padding: 14px 14px;
      border-bottom: 1px solid rgba(255,255,255,.12);
    }
    .modal-head strong{ font-size: 14px; }
    .xbtn{
      border:none;
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.14);
      color: var(--text);
      border-radius: 10px;
      padding: 8px 10px;
      cursor:pointer;
    }
    .modal-body{ padding: 14px; display:grid; gap: 10px; }
    .field{ display:grid; gap: 6px; }
    label{ font-size: 12px; color: var(--muted); }
    input[type="text"], textarea, select, input[type="file"]{
      width: 100%;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.14);
      color: var(--text);
      border-radius: 12px;
      padding: 10px 10px;
      outline: none;
      font-size: 14px;
    }
    textarea{ min-height: 90px; resize: vertical; }
    .row{ display:grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    @media (max-width: 560px){ .row{ grid-template-columns: 1fr; } }

    .modal-foot{
      padding: 12px 14px 14px;
      border-top: 1px solid rgba(255,255,255,.12);
      display:flex;
      gap: 10px;
      justify-content:flex-end;
      align-items:center;
    }
    .ghost{
      background: rgba(255,255,255,.07);
      color: var(--text);
      border: 1px solid rgba(255,255,255,.14);
    }
  </style>
</head>

<body>
  <div class="frame">
    <div class="container">

      <header>
        <div class="brand">
          <img class="logo" src="./assets/animated-logo-new.svg" alt="WookStars Logo">
        </div>

        <div class="top-actions">
          <div class="pill" title="Search">
            üîé
            <input id="search" type="text" placeholder="Search videos‚Ä¶">
          </div>
          <button class="btn" id="openSubmit" type="button">Submit a Video</button>
        </div>
      </header>

      <section class="tagline">
        <h1>Welcome to WookStars</h1>
        <p>The wildest rave clips, festival chaos, and underground moments ‚Äî posted by the community.</p>
      </section>

      <div class="cats" id="cats"></div>

      <main>
        <section>
          <div class="feed" id="feed"></div>
        </section>

        <aside>
          <div class="panel">
            <h2>Status</h2>
            <p id="statusText" class="small">Connecting‚Ä¶</p>
          </div>

          <div class="panel">
            <h2>Future Monetization</h2>
            <p class="small">Later: ads slots, merch/art shop page, and creator pages.</p>
          </div>
        </aside>
      </main>

      <footer>
        ¬© <span id="year"></span> WookStars ‚Ä¢ Anonymous uploads (beta)
      </footer>
    </div>
  </div>

  <!-- MODAL -->
  <div class="modal-backdrop" id="modalBackdrop" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-label="Submit a video">
      <div class="modal-head">
        <strong>Submit a Video (Anonymous)</strong>
        <button class="xbtn" id="closeSubmit" aria-label="Close" type="button">‚úï</button>
      </div>

      <div class="modal-body">
        <div class="field">
          <label for="videoTitle">Title</label>
          <input id="videoTitle" type="text" placeholder="e.g., ‚ÄòBass drop sent him to another dimension‚Äô">
        </div>

        <div class="row">
          <div class="field">
            <label for="videoCategory">Category</label>
            <select id="videoCategory"></select>
          </div>
          <div class="field">
            <label for="videoFile">Video File</label>
            <input id="videoFile" type="file" accept="video/*">
          </div>
        </div>

        <div class="field">
          <label for="videoDesc">Description (optional)</label>
          <textarea id="videoDesc" placeholder="What happened? Where? (No personal info)"></textarea>
        </div>

        <div class="small">Anonymous beta uploads are currently limited (keep files small). Moderation comes next.</div>
      </div>

      <div class="modal-foot">
        <button class="btn ghost" id="cancelSubmit" type="button">Cancel</button>
        <button class="btn" id="saveSubmit" type="button">Upload</button>
      </div>
    </div>
  </div>

  <script>
    // ===== CONFIG =====
    const API_BASE = "https://wookstars-api.sergio-llovio.workers.dev";
    const categories = ["All","Festival","Rave","Wookin","Fails","Fights","WTF","Animals","News"];

    // ===== UI refs =====
    const feedEl = document.getElementById("feed");
    const catsEl = document.getElementById("cats");
    const searchEl = document.getElementById("search");
    const statusText = document.getElementById("statusText");

    let activeCategory = "All";
    let searchTerm = "";
    let videos = [];

    function formatViews(n){
      n = Number(n) || 0;
      if (n >= 1_000_000) return (n/1_000_000).toFixed(1).replace(/\.0$/,'') + "M";
      if (n >= 1_000) return (n/1_000).toFixed(1).replace(/\.0$/,'') + "K";
      return String(n);
    }

    const placeholderThumb = (seed) => {
      const svg = encodeURIComponent(`
        <svg xmlns="http://www.w3.org/2000/svg" width="1280" height="720">
          <defs>
            <linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0" stop-color="hsl(${seed%360},90%,55%)"/>
              <stop offset="1" stop-color="hsl(${(seed+140)%360},90%,55%)"/>
            </linearGradient>
          </defs>
          <rect width="100%" height="100%" fill="url(#g)"/>
          <circle cx="980" cy="220" r="170" fill="rgba(0,0,0,.25)"/>
          <text x="60" y="640" font-size="64" fill="rgba(0,0,0,.38)" font-family="Arial Black">WOOKSTARS</text>
        </svg>
      `);
      return `data:image/svg+xml;charset=utf-8,${svg}`;
    };

    function renderCats(){
      catsEl.innerHTML = "";
      categories.forEach(cat => {
        const b = document.createElement("div");
        b.className = "chip" + (cat === activeCategory ? " active" : "");
        b.textContent = cat;
        b.onclick = () => { activeCategory = cat; renderCats(); renderFeed(); };
        catsEl.appendChild(b);
      });
    }

    function matches(v){
      const catOk = (activeCategory === "All" || v.category === activeCategory);
      const term = searchTerm.trim().toLowerCase();
      const title = (v.title || "").toLowerCase();
      const cat = (v.category || "").toLowerCase();
      const termOk = !term || title.includes(term) || cat.includes(term);
      return catOk && termOk;
    }

    function renderFeed(){
      const list = videos.filter(matches);
      feedEl.innerHTML = "";

      list.forEach(v => {
        const card = document.createElement("article");
        card.className = "card";
        const href = `./watch.html?id=${encodeURIComponent(v.id)}`;

card.innerHTML = `
  <a class="link" href="${href}">
    <div class="thumb">
      <img src="${v.thumb}" alt="">
      <div class="badge">${v.category}</div>
      <div class="play">‚ñ∂ ${formatViews(v.views)} views</div>
    </div>
    <div class="meta">
      <h3 class="title">${v.title}</h3>
      <div class="sub">
        <span>Anonymous</span>
      </div>
    </div>
  </a>
`;
        feedEl.appendChild(card);
      });

      if (!list.length){
        feedEl.innerHTML = `
          <div class="panel" style="grid-column: 1 / -1;">
            <h2>No videos yet</h2>
            <p>Be the first to upload one with ‚ÄúSubmit a Video‚Äù.</p>
          </div>
        `;
      }
    }

    searchEl.addEventListener("input", (e) => {
      searchTerm = e.target.value;
      renderFeed();
    });

    // ===== Modal =====
    const modalBackdrop = document.getElementById("modalBackdrop");
    const openSubmit = document.getElementById("openSubmit");
    const closeSubmit = document.getElementById("closeSubmit");
    const cancelSubmit = document.getElementById("cancelSubmit");
    const saveSubmit = document.getElementById("saveSubmit");

    const videoTitle = document.getElementById("videoTitle");
    const videoCategory = document.getElementById("videoCategory");
    const videoDesc = document.getElementById("videoDesc");
    const videoFile = document.getElementById("videoFile");

    function openModal(){
      modalBackdrop.style.display = "flex";
      modalBackdrop.setAttribute("aria-hidden","false");
      videoTitle.focus();
    }
    function closeModal(){
      modalBackdrop.style.display = "none";
      modalBackdrop.setAttribute("aria-hidden","true");
      videoTitle.value = "";
      videoDesc.value = "";
      videoFile.value = "";
      videoCategory.value = categories[1];
    }

    openSubmit.onclick = openModal;
    closeSubmit.onclick = closeModal;
    cancelSubmit.onclick = closeModal;
    modalBackdrop.onclick = (e) => { if (e.target === modalBackdrop) closeModal(); };
    window.addEventListener("keydown", (e) => {
      if (e.key === "Escape" && modalBackdrop.style.display === "flex") closeModal();
    });

    function populateCategorySelect(){
      videoCategory.innerHTML = "";
      categories.filter(c => c !== "All").forEach(c => {
        const opt = document.createElement("option");
        opt.value = c;
        opt.textContent = c;
        videoCategory.appendChild(opt);
      });
      videoCategory.value = categories[1];
    }

    async function loadFromApi(){
      try{
        statusText.textContent = "Loading from API‚Ä¶";
        const res = await fetch(`${API_BASE}/api/videos`);
        const data = await res.json();
        if (!data.ok) throw new Error(data.error || "API error");

        videos = (data.items || []).map(v => ({ ...v, thumb: placeholderThumb((v.id || '').length * 57) }));
        statusText.textContent = "Connected ‚úÖ";
      }catch(err){
        statusText.textContent = "API offline (showing demo cards) ‚ö†Ô∏è";
        videos = [
          { id:"demo1", title:"Demo: first upload coming soon", category:"Festival", views:0, created_at:new Date().toISOString(), thumb: placeholderThumb(12) },
          { id:"demo2", title:"Demo: wook moment compilation", category:"WTF", views:0, created_at:new Date().toISOString(), thumb: placeholderThumb(99) },
        ];
      }finally{
        renderFeed();
      }
    }

    saveSubmit.onclick = async () => {
      const title = videoTitle.value.trim();
      const category = videoCategory.value;
      const description = videoDesc.value.trim();

      if (!title){ alert("Please enter a title."); return; }
      if (!videoFile.files || !videoFile.files[0]){ alert("Please select a video file."); return; }

      const file = videoFile.files[0];

      const formData = new FormData();
      formData.append("title", title);
      formData.append("category", category);
      formData.append("description", description);
      formData.append("file", file);

      try{
        saveSubmit.disabled = true;
        saveSubmit.textContent = "Uploading‚Ä¶";

        const res = await fetch(`${API_BASE}/api/upload`, {
          method: "POST",
          body: formData
        });

        const data = await res.json();
        if (!data.ok) throw new Error(data.error || "Upload failed");

        closeModal();
        alert("Upload successful! Taking you to the watch page‚Ä¶");
        window.location.href = `./watch.html?id=${encodeURIComponent(data.id)}`;
      }catch(err){
        alert("Upload failed: " + (err && err.message ? err.message : err));
      }finally{
        saveSubmit.disabled = false;
        saveSubmit.textContent = "Upload";
      }
    };

    // ===== Init =====
    document.getElementById("year").textContent = new Date().getFullYear();
    renderCats();
    populateCategorySelect();
    loadFromApi();
  </script>
</body>
</html>
